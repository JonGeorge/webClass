How to Setup IntelliJ and Debug a Grails 2.3.11 Web App
-------------------------------------------------------
IntelliJ allows you to debug Grails web applications without any special settings.


ASSUMPTIONS:
 1) You are running a 64-bit version of Windows  (Windows Vista, Windows 7, Windows 8 or later)
 2) You want to install the community edition of IntelliJ
 3) You have Java JDK 1.7.75 already installed
 4) You have Maven already installed


Procedures
----------
1. Install IntelliJ Community Edition 14.1.4
   a) Download IntelliJ Community Edition
      1. Go to http://www.jetbrains.com/idea/download/index.html
      2. Click the "Download Community" button 
      3. Save ideaIC-14.1.4.exe  c:\vault\
   
   b) Install IntelliJ
      1. Run this program:  c:\vault\ideaIC-14.1.4.exe

      2. In the "Welcome to Intellij IDEA" screen, press Next
      
      3. In the "Choose Install Location" screen,  
         Set the destination directory to be:
            c:\tools\intellij
            Press Next
            
      4. In the "Installation Options" screen
         Check "Create Desktop Shortcut"
         Press Next
         
         
      5. In the "Choose Start Menu Folder", screen
         go with the default name 
         Press Install
      
      6. In the "Completing Intellij IDEA community edition", screen
         Press FInish
   
         
2. Configure Intellij
 	a) Run IntelliJ  (there should be a shortcut on your desktop)
 	   Or click on C:\tools\intellij\bin\idea.exe
 	   
 	b) You may be asked if you wan to import your settings
 	   select "I do not have a previous version Of IntelliJ IDEA"
 	   Press OK
 	   
 	c) In the "Set UI Theme"
 	   select "IntelliJ" and press "Next: Default Plugins"
 	   
 	d) In the "Tune IDEA to your tasks"
 	   select "Next: Feature plugins"
 	   
 	e) In the "Download feature plugins"
 	   select "Start using Intellij IDEA"
 	   
    f) Close Intellij
    
    g) Create a workspace directory
       Create this directory:   c:\tools\intellij\workspace


3. Install Grails 2.3.11
   a) Download Grails
      1. Go to https://github.com/grails/grails-core/releases/download/v2.3.11/grails-2.3.11.zip
      2. Save grails-2.3.11.zip to your c:\vault directory
         
         
   b) Install Grails
      1. Right-click on c:\vault\grails-2.3.11  -> 7zip -> Extract Files....
      2. In the "Extract To" directory, type-in  c:\tools 
         Press OK
         
         Now, you have grails installed to here:
            c:\tools\grails-2.3.11
            
      3. Set your GRAILS_HOME environment variable to be c:\tools\grails-2.3.11
         a. Open the Environment Variables in Windows by pressing <Start><Run>environment
 
         b. Under "User variables for..." [on the top of this popup], 
	        click "New..."
	              Variable name:  GRAILS_HOME
                  Variable value: c:\tools\grails-2.3.11
		 
		    NOTE:  You have to open a *NEW* dos window to see environment variable changes
		    
		    
		
     4. Add the c:\tools\grails-2.3.11\bin directory to your path
 		 a. Open the Environment Variables in Windows by pressing <Start><Run>environment

		 b. Under "User variables for..." [on the top of this popup], 
			click "New..."  [if PATH already exists, then double-click on PATH and add a semicolon and append this to the end of the PATH]
		    	Variable name:  PATH
                Variable value: c:\tools\grails-2.3.11\bin
     	 
		    NOTE:  You have to open a *NEW* dos window to see environment variable changes
    
    	
    d. Verify Grails is instaled
	  1. Press <Start><Run>CMD
	     DOS> grails -version
	  
	     You should see the following:
         Grails version: 2.3.11
   
       	   
3. Create a Grails web 2 application with maven integration
   NOTE:  These procedures will *NOT* work with Grails 3

    a) Create the grails app
       Open a DOS window by pressing <Start><Run>CMD
       DOS> cd /d c:\tools\intellij\workspace
       DOS> grails create-app webapp2   --plain-output 
            NOTE:  Now, you should have a grails app created here:
                   c:\tools\intellij\workspace\webapp2
                   
    b) Create the pom.xml for your grails app
       DOS> cd webapp2
       DOS> grails create-pom com.resnick  --plain-output 
       Now, you should have a pom.xml located here:
          c:\tools\intellij\workspace\webapp2\pom.xml
     
    c) Create an Intellij file   
       DOS> grails integrate-with --intellij    --plain-output 
       Now, you should have Intellij files located here:
          c:\tools\intellij\workspace\webapp2\webapp2.iws
          c:\tools\intellij\workspace\webapp2\webapp2.ipr     <-- this is the file you can click on with Intellij
          c:\tools\intellij\workspace\webapp2\webapp2.iml
          
 
    d) Create a simple Domain class called Person
       DOS> grails create-domain-class Person   --plain-output 
    
    e) Create the HelloController class
       DOS> grails create-controller Hello   --plain-output 
       
     
    f) Modify the Person class
       1) Edit grails-app/domain/webapp2/Person.groovy to be this:
          
           package webapp2
           
	       class Person {
                 String firstName
                 String lastName
                 int age
			}

       
       
     g) Edit grails-app/controllers/webapp2/HelloController.groovy to match the code below
            package webapp2
			                       
			class HelloController 
			{
			
			  def index()
			   {
                  Person person = new Person(firstName: 'John', lastName:'Doe', age:55)
                  
                  render view: "/hello/index", model: [person: person]
                }
			}


	 h) Edit the view
	    Create a file here:
	       C:\tools\intellij\workspace\webapp2\grails-app\views\hello\index.gsp
		
		Copy + Paste this into your index.gsp file
		
        <!DOCTYPE html>
        <html>
        <head>
            <meta name="layout" content="main"/>
            <title>Render Domain</title>
        </head>
        <body>
        Last Name: ${person.lastName} <br/>
        First Name: ${person.firstName} <br/>
        Age: ${person.age} <br/>
        </body>
        </html>
                
    
    
 4. Run Application from the command-line
    DOS> cd /d c:\tools\intellij\workspace\webapp2
    DOS> grails run-app  --plain-output
     
	You should see this output:
	|Loading Grails 2.3.11
	|Configuring classpath
	.
	|Environment set to development
	.................................
	|Packaging Grails application
	...........
	|Compiling 4 source files
	.........................
	|Running Grails application
	|Server running. Browse to http://localhost:8080/webapp2
	
	
 5. View the webapp in your web browser:
    a) Open a web browser
    b) Go to http://localhost:8080/webapp2
    c) Click on "webapp2.HelloController"
       -- You should see 
        Last Name: Doe
        First Name: John
        Age: 55 
         
         
 6. Stop the grails webapp by pressing Control-C in the DOS window
 
         
 7. Open the project with Intellij
       a) Find the webapp2.ipr file
          Browse to C:\tools\intellij\workspace\webapp2
          Double-click on webapp2.ipr
          -- Intellij should open this project
          
       b) If you get a warning that says
           "The project has an older format"
           Press the Convert button
  
       c) Wait for Intellij to finish indexing
       
       d) Right-click on the pom.xml -> Add as Maven Project
          Wait for Intellij to finish resolving the maven dependencies
      
       e) Pull Run / Edit Configuration
           1) In the Run/Debug Configurations window
              press the "+" symbol
           2) Select Remote
           3) Enter these values:
              Name:           remote-mywebapp2
              Transport:      Socket
              Debugger Mode:  Attach
              Host:           localhost
              Port:           5005
              
           4) Press Apply
           5) Press OK
                       

 8. Fix the spock unit tests so they execute properly
     a) Browse to test/unit/webapp2/HelloControllerSpec
        
        Add this:
        
           void test()
             {
                  given: "test given"
                 System.out.println("HelloControllerSpec test finished")
             }

     b) Browse to test/unit/webapp2/PersonSpec
        Add this:
        
           void test()
             {
                 given: "test given"
                 System.out.println("PersonSpec test finished")
             }
         
        Now, the tests will run properly
      
  
  
  
 9. Tell Maven to run grails in forked mode
 
    Edit your grails-maven-plugin so that it has the <folk>true</fork>
    
    It should look seomthing like this:
    
              <plugin>
                <groupId>org.grails</groupId>
                <artifactId>grails-maven-plugin</artifactId>
                <version>2.4.4</version>
                <configuration>
                    <grailsVersion>${grails.version}</grailsVersion>

                    <!-- Whether to Fork a JVM to run Grails commands -->
                    <fork>true</fork>
                                        
                </configuration>
                <extensions>true</extensions>
            </plugin>
    
   
   
10. Debug the Grails web app
     a) In Intellij, setup a breakpoint in the Hello Controller
        -- Press Shift-Shift
        -- Start typing in HelloController
        -- Select HelloController (webapp2)
        -- In the HelloController.groovy class, 
           Set a breakpoint on one of the lines in index()
        
     
	 b) Open a DOS window by pressing <Start><Run>CMD
        In the DOS window type-in this:
	    DOS> cd /d c:\tools\intellij\workspace\webapp2
	    DOS> mvn grails:run-app -DforkDebug=true
	         or
	    DOS> grails -debug run-app  --plain-output
	    
	 c) Wait for the DOS window to say this:
	    Listening for transport dt_socket at address: 5005
	    
	    
	 d) Back in Intellij, pull Run / Debug remote-webapp2
	 
     e) Open a web browser and go to http://localhost:8080/webapp2
     
     f) Click on "webapp2.HelloController"
        -- Intellij should stop at your breakpoint in HelloController.groovy
        -- Press F9 to resume
      
     g) Press Control-C in your DOS window to kill your app server
     
     



How to solve this WARNING: Could not open/create prefs root node Software\JavaSoft\Prefs at root 0x80000002
----------------------------------------------------------------------------------------- 

